<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Memory Optimization with Lazy Operators · Documentation | HierarchicalEOM.jl</title><meta name="title" content="Memory Optimization with Lazy Operators · Documentation | HierarchicalEOM.jl"/><meta property="og:title" content="Memory Optimization with Lazy Operators · Documentation | HierarchicalEOM.jl"/><meta property="twitter:title" content="Memory Optimization with Lazy Operators · Documentation | HierarchicalEOM.jl"/><meta name="description" content="Documentation for Documentation | HierarchicalEOM.jl."/><meta property="og:description" content="Documentation for Documentation | HierarchicalEOM.jl."/><meta property="twitter:description" content="Documentation for Documentation | HierarchicalEOM.jl."/><meta property="og:url" content="https://qutip.github.io/HierarchicalEOM.jl/heom_matrix/lazy_operators/"/><meta property="twitter:url" content="https://qutip.github.io/HierarchicalEOM.jl/heom_matrix/lazy_operators/"/><link rel="canonical" href="https://qutip.github.io/HierarchicalEOM.jl/heom_matrix/lazy_operators/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img class="docs-light-only" src="../../assets/logo.png" alt="Documentation | HierarchicalEOM.jl logo"/><img class="docs-dark-only" src="../../assets/logo-dark.png" alt="Documentation | HierarchicalEOM.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Documentation | HierarchicalEOM.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><span class="tocitem">Home</span><ul><li><a class="tocitem" href="../../">Introduction</a></li><li><a class="tocitem" href="../../install/">Installation</a></li><li><a class="tocitem" href="../../quick_start/">Quick Start</a></li><li><a class="tocitem" href="../../cite/">Cite HierarchicalEOM.jl</a></li></ul></li><li><span class="tocitem">Manual</span><ul><li><input class="collapse-toggle" id="menuitem-2-1" type="checkbox"/><label class="tocitem" for="menuitem-2-1"><span class="docs-label">Bosonic Bath</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../bath_boson/bosonic_bath_intro/">Introduction</a></li><li><a class="tocitem" href="../../bath_boson/Boson_Drude_Lorentz/">Drude-Lorentz Spectral Density</a></li><li><a class="tocitem" href="../../bath_boson/Boson_Underdamped/">Underdamped Spectral Density</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-2" type="checkbox"/><label class="tocitem" for="menuitem-2-2"><span class="docs-label">Bosonic Bath (RWA)</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../bath_boson_RWA/bosonic_bath_RWA_intro/">Introduction</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-3" type="checkbox"/><label class="tocitem" for="menuitem-2-3"><span class="docs-label">Fermionic Bath</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../bath_fermion/fermionic_bath_intro/">Introduction</a></li><li><a class="tocitem" href="../../bath_fermion/Fermion_Lorentz/">Lorentz Spectral Density</a></li></ul></li><li><a class="tocitem" href="../../ADOs/">Auxiliary Density Operators</a></li><li><input class="collapse-toggle" id="menuitem-2-5" type="checkbox" checked/><label class="tocitem" for="menuitem-2-5"><span class="docs-label">HEOMLS Matrices</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../HEOMLS_intro/">Introduction</a></li><li><a class="tocitem" href="../schrodinger_eq/">HEOMLS for Schrödinger Equation</a></li><li><a class="tocitem" href="../M_Boson/">HEOMLS for Bosonic Bath</a></li><li><a class="tocitem" href="../M_Fermion/">HEOMLS for Fermionic Bath</a></li><li><a class="tocitem" href="../M_Boson_Fermion/">HEOMLS for Bosonic and Fermionic Bath</a></li><li><a class="tocitem" href="../master_eq/">HEOMLS for Master Equation</a></li><li class="is-active"><a class="tocitem" href>Memory Optimization with Lazy Operators</a><ul class="internal"><li><a class="tocitem" href="#Introduction"><span>Introduction</span></a></li><li><a class="tocitem" href="#The-assemble-keyword-argument"><span>The <code>assemble</code> keyword argument</span></a></li><li><a class="tocitem" href="#Demonstrating-Memory-Savings"><span>Demonstrating Memory Savings</span></a></li></ul></li></ul></li><li><a class="tocitem" href="../../Parity/">Parity Support</a></li><li><a class="tocitem" href="../../hierarchy_dictionary/">Hierarchy Dictionary</a></li><li><a class="tocitem" href="../../time_evolution/">Time Evolution</a></li><li><a class="tocitem" href="../../stationary_state/">Stationary State</a></li><li><a class="tocitem" href="../../spectrum/">Spectrum</a></li><li><a class="tocitem" href="../../examples/">Examples</a></li><li><input class="collapse-toggle" id="menuitem-2-12" type="checkbox"/><label class="tocitem" for="menuitem-2-12"><span class="docs-label">Solvers Lists</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../ODE_solvers/">DifferentialEquations solvers</a></li><li><a class="tocitem" href="../../LS_solvers/">LinearSolve solvers</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-13" type="checkbox"/><label class="tocitem" for="menuitem-2-13"><span class="docs-label">Extensions</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../extensions/CUDA/">CUDA.jl</a></li></ul></li></ul></li><li><a class="tocitem" href="../../libraryAPI/">Library API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li><a class="is-disabled">HEOMLS Matrices</a></li><li class="is-active"><a href>Memory Optimization with Lazy Operators</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Memory Optimization with Lazy Operators</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/qutip/HierarchicalEOM.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/qutip/HierarchicalEOM.jl/blob/main/docs/src/heom_matrix/lazy_operators.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="doc-Lazy-Operators"><a class="docs-heading-anchor" href="#doc-Lazy-Operators">Memory Optimization with Lazy Operators</a><a id="doc-Lazy-Operators-1"></a><a class="docs-heading-anchor-permalink" href="#doc-Lazy-Operators" title="Permalink"></a></h1><h2 id="Introduction"><a class="docs-heading-anchor" href="#Introduction">Introduction</a><a id="Introduction-1"></a><a class="docs-heading-anchor-permalink" href="#Introduction" title="Permalink"></a></h2><p><code>HierarchicalEOM.jl</code> provides a memory-efficient lazy evaluation feature for HEOM Liouvillian superoperator (HEOMLS) matrices using <a href="https://docs.sciml.ai/SciMLOperators/stable/"><code>SciMLOperators.TensorProductOperator</code></a>. This feature can significantly reduce memory usage for large systems.</p><p>By default, a HEOMLS matrix is assembled as a single large sparse matrix with space complexity (memory scaling) as:</p><p class="math-container">\[\mathcal{O}(N_{\text{ADO}}^2 \cdot d^4)\]</p><p>where <span>$d$</span> is the system dimension, and <span>$N_{\text{ADO}}$</span> is the number of auxiliary density operators (ADOs) which grows rapidly with hierarchy tier and number of bath terms.</p><p>Instead of assembling HEOMLS into a single large sparse matrix, the lazy operator feature represents it as a sum of Kronecker products:</p><p class="math-container">\[\hat{\mathcal{M}} = \sum_i A_i \otimes B_i,\]</p><p>where <span>$B_i$</span> represent the system coupling superoperators, and <span>$A_i$</span> encodes the hierarchy (ADO) connectivity pattern and corresponding prefix values of <span>$B_i$</span>. In this case, the space complexity (memory allocation) has been reduced to</p><p class="math-container">\[\mathcal{O}(N_{\text{ADO}}^2 + d^4),\]</p><p>which significantly lowers the memory requirements for high-dimensional simulations. The key insight is that the <span>$B_i$</span> (system coupling superoperator) matrices are small (size <span>$d^2 \times d^2$</span>) and shared across different connections (coupling) between ADOs, while only the <span>$A_i$</span> matrices (hierarchy connectivity patterns) need to scale with <span>$N_{\text{ADO}}^2$</span>.</p><p>Memory savings scale with the number of ADOs, making this especially beneficial for:</p><ul><li>High hierarchy tiers</li><li>Multiple bath terms</li><li>Large system dimensions</li><li>Long-time dynamics requiring high accuracy</li></ul><h2 id="The-assemble-keyword-argument"><a class="docs-heading-anchor" href="#The-assemble-keyword-argument">The <code>assemble</code> keyword argument</a><a id="The-assemble-keyword-argument-1"></a><a class="docs-heading-anchor-permalink" href="#The-assemble-keyword-argument" title="Permalink"></a></h2><p>The <code>assemble</code> keyword argument controls how the HEOMLS matrix is constructed. It is available in:</p><ul><li><a href="../../libraryAPI/#HierarchicalEOM.M_Boson"><code>M_Boson</code></a></li><li><a href="../../libraryAPI/#HierarchicalEOM.M_Fermion"><code>M_Fermion</code></a></li><li><a href="../../libraryAPI/#HierarchicalEOM.M_Boson_Fermion"><code>M_Boson_Fermion</code></a></li></ul><h3 id="assemble-Val(:full)-Full-Sparse-Matrix-(Default)"><a class="docs-heading-anchor" href="#assemble-Val(:full)-Full-Sparse-Matrix-(Default)"><code>assemble = Val(:full)</code> - Full Sparse Matrix (Default)</a><a id="assemble-Val(:full)-Full-Sparse-Matrix-(Default)-1"></a><a class="docs-heading-anchor-permalink" href="#assemble-Val(:full)-Full-Sparse-Matrix-(Default)" title="Permalink"></a></h3><p>Assembles the complete HEOMLS matrix as a single sparse matrix. This is the default behavior for backward compatibility.</p><pre><code class="language-julia hljs">L_full = M_Boson(Hsys, tier, bath; assemble = Val(:full))</code></pre><h3 id="assemble-Val(:combine)-Combined-Lazy-Operators-(Recommended)"><a class="docs-heading-anchor" href="#assemble-Val(:combine)-Combined-Lazy-Operators-(Recommended)"><code>assemble = Val(:combine)</code> - Combined Lazy Operators (Recommended)</a><a id="assemble-Val(:combine)-Combined-Lazy-Operators-(Recommended)-1"></a><a class="docs-heading-anchor-permalink" href="#assemble-Val(:combine)-Combined-Lazy-Operators-(Recommended)" title="Permalink"></a></h3><p>Combines terms with identical system coupling superoperators (<span>$B_i$</span>) but does not materialize the full matrix. This provides excellent memory savings while maintaining computational efficiency. The lazy representation can leverage matrix-matrix multiplication patterns, which are more parallelizable than the sparse matrix-vector products used by full assembly.</p><pre><code class="language-julia hljs">L_combine = M_Boson(Hsys, tier, bath; assemble = Val(:combine))</code></pre><p>Recommended for most applications, especially memory-constrained devices.</p><h3 id="assemble-Val(:none)-Individual-Lazy-Operators-(For-Sparsity-Analysis)"><a class="docs-heading-anchor" href="#assemble-Val(:none)-Individual-Lazy-Operators-(For-Sparsity-Analysis)"><code>assemble = Val(:none)</code> - Individual Lazy Operators (For Sparsity Analysis)</a><a id="assemble-Val(:none)-Individual-Lazy-Operators-(For-Sparsity-Analysis)-1"></a><a class="docs-heading-anchor-permalink" href="#assemble-Val(:none)-Individual-Lazy-Operators-(For-Sparsity-Analysis)" title="Permalink"></a></h3><p>Keeps all tensor product terms separate without any combination. This mode actually uses more memory than <code>Val(:combine)</code> because <code>Val(:combine)</code> reduces the number of terms in the <code>SciMLOperators.AddedOperator</code> by grouping terms with identical system coupling superoperators. However, <code>Val(:none)</code> provides flexibility for investigating sparsity patterns and analyzing the structure of individual tensor product terms.</p><pre><code class="language-julia hljs">L_none = M_Boson(Hsys, tier, bath; assemble = Val(:none))</code></pre><h2 id="Demonstrating-Memory-Savings"><a class="docs-heading-anchor" href="#Demonstrating-Memory-Savings">Demonstrating Memory Savings</a><a id="Demonstrating-Memory-Savings-1"></a><a class="docs-heading-anchor-permalink" href="#Demonstrating-Memory-Savings" title="Permalink"></a></h2><pre><code class="language-julia hljs"># spin-boson model
Hsys = 1.0 * sigmaz() + 0.25 * sigmax()

Δ  = 0.1 # coupling strength
W  = 0.2 # band-width  of the environment
kT = 0.5 # the product of the Boltzmann constant k and the absolute temperature T
N  = 10  # Number of exponential terms
baths = [
    Boson_DrudeLorentz_Pade(sigmax(), 0.01, 0.5, 0.5, 3),
    Boson_DrudeLorentz_Pade(sigmax(), 0.01, 0.5, 0.5, 3),
]

# Create matrices with different assembly modes
tier = 10
L_full    = M_Boson(Hsys, tier, baths; assemble=Val(:full),    verbose=false)
L_combine = M_Boson(Hsys, tier, baths; assemble=Val(:combine), verbose=false)
L_none    = M_Boson(Hsys, tier, baths; assemble=Val(:none),    verbose=false)</code></pre><p>Use <code>Base.summarysize</code> to measure and compare memory usage (convert to <code>MB</code>)</p><pre><code class="language-julia hljs">mem_full = Base.summarysize(L_full.data) / 1024^2
mem_combine = Base.summarysize(L_combine.data) / 1024^2
mem_none = Base.summarysize(L_none.data) / 1024^2

print(
    &quot;System dimension (d)     : $(size(Hsys, 1))\n&quot;,
    &quot;Number of ADOs   (N_ADO) : $(L_full.N)\n&quot;,
    &quot;L_full matrix size       : $(size(L_full, 1)) × $(size(L_full, 2))\n&quot;,
    &quot;L_full non-zero elements : $(nnz(L_full.data.A))\n&quot;,
    &quot;\n&quot;,
    &quot;Memory usage:\n&quot;,
    &quot;  full    : $(round(mem_full, digits=3)) MB\n&quot;,
    &quot;  combine : $(round(mem_combine, digits=3)) MB\n&quot;,
    &quot;  none    : $(round(mem_none, digits=3)) MB\n&quot;,
    &quot;Memory reduction:\n&quot;,
    &quot;  combine vs full : $(round(100 * (1 - mem_combine/mem_full), digits=1))%\n&quot;,
    &quot;   none   vs full : $(round(100 * (1 - mem_none/mem_full), digits=1))%\n&quot;,
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">System dimension (d)     : 2
Number of ADOs   (N_ADO) : 43758
L_full matrix size       : 175032 × 175032
L_full non-zero elements : 3636774

Memory usage:
  full    : 93.477 MB
  combine : 15.359 MB
  none    : 16.027 MB
Memory reduction:
  combine vs full : 83.6%
   none   vs full : 82.9%</code></pre><p>In this case, you might see memory reductions of 80-90% with lazy operators. The savings increase dramatically with higher tiers and more ADOs.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../master_eq/">« HEOMLS for Master Equation</a><a class="docs-footer-nextpage" href="../../Parity/">Parity Support »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.17.0 on <span class="colophon-date" title="Sunday 22 February 2026 05:30">Sunday 22 February 2026</span>. Using Julia version 1.12.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
